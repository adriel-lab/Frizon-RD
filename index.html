<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documenta√ß√£o Interativa - Frizon & RD Station</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- 
    Chosen Palette: Warm Neutrals (Slate & Teal)
    Application Structure Plan: A single-page application with a fixed sidebar for navigation and a main content area. This structure is ideal for documentation, allowing users to quickly jump between sections without losing context. Key interactive elements are a visual process flow diagram and a code explorer with contextual explanations to make a dense technical document more digestible for developers and maintainers.
    Visualization & Content Choices: 
     - Report Info: Process Flow -> Goal: Organize/Inform -> Viz: HTML/CSS Diagram -> Interaction: Hover to highlight stages. Justification: Visual flows are easier to understand than text descriptions. Library: Tailwind CSS.
     - Report Info: PHP Code -> Goal: Explain -> Viz: Code block with annotations -> Interaction: Click on markers to show contextual help. Justification: Breaks down complex code into understandable parts. Library: Custom JS.
     - Report Info: Maintenance steps -> Goal: Inform -> Viz: Accordion -> Interaction: Click to expand/collapse. Justification: Prevents information overload. Library: Custom JS.
    CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .nav-link.active {
            background-color: #F0FDFA; /* teal-50 */
            color: #134E4A; /* teal-900 */
            font-weight: 600;
        }
        .code-marker {
            cursor: pointer;
            background-color: #CCFBF1; /* teal-200 */
            padding: 0 4px;
            border-radius: 4px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .code-marker:hover {
            background-color: #99F6E4; /* teal-300 */
        }
        .code-marker.active {
            background-color: #FBBF24; /* amber-400 */
        }
        .flow-step {
            transition: all 0.3s ease;
            border-color: #E2E8F0; /* slate-200 */
        }
        .flow-step:hover {
            transform: translateY(-4px);
            border-color: #0D9488; /* teal-600 */
            box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.05);
        }
        .flow-arrow {
            color: #94A3B8; /* slate-400 */
        }
        .flow-step:hover .flow-arrow {
            color: #0D9488; /* teal-600 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-slate-200 flex-shrink-0">
            <div class="p-6">
                <h1 class="text-xl font-bold text-slate-900">Frizon & RD</h1>
                <p class="text-sm text-slate-500">Documenta√ß√£o Interativa</p>
            </div>
            <nav id="main-nav" class="px-4">
                <a href="#overview" class="nav-link flex items-center px-4 py-2 text-slate-700 rounded-md hover:bg-slate-100 transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Vis√£o Geral
                </a>
                <a href="#architecture" class="nav-link flex items-center px-4 py-2 mt-2 text-slate-700 rounded-md hover:bg-slate-100 transition-colors">
                     <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    Arquitetura
                </a>
                <a href="#mapping" class="nav-link flex items-center px-4 py-2 mt-2 text-slate-700 rounded-md hover:bg-slate-100 transition-colors">
                     <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002-2h2a2 2 0 002 2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                    Mapeamento
                </a>
                <a href="#code" class="nav-link flex items-center px-4 py-2 mt-2 text-slate-700 rounded-md hover:bg-slate-100 transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                    Explorador de C√≥digo
                </a>
                <a href="#maintenance" class="nav-link flex items-center px-4 py-2 mt-2 text-slate-700 rounded-md hover:bg-slate-100 transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    Manuten√ß√£o
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10">
            
            <!-- Section: Vis√£o Geral -->
            <section id="overview" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Vis√£o Geral do Projeto</h2>
                <p class="text-lg text-slate-600 mb-8">Automatizar a captura e distribui√ß√£o de leads, otimizando o processo comercial desde o primeiro contato.</p>
                
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Fluxo da Automa√ß√£o</h3>
                    <p class="text-slate-600 mb-6">Esta automa√ß√£o cria um pipeline de dados robusto que conecta o formul√°rio do site diretamente ao corretor certo. Cada etapa foi projetada para garantir que nenhum lead seja perdido e a distribui√ß√£o seja justa e imediata. Explore o diagrama abaixo para entender o percurso do lead.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 items-center text-center">
                        <div class="flow-step bg-white p-4 rounded-lg border-2">
                            <div class="text-3xl mb-2">üì¨</div>
                            <h4 class="font-semibold">1. Envio do Formul√°rio</h4>
                            <p class="text-xs text-slate-500">Usu√°rio preenche e envia dados no site.</p>
                        </div>
                        <div class="flow-arrow text-2xl hidden md:block">‚Üí</div>
                        <div class="flow-step bg-white p-4 rounded-lg border-2">
                            <div class="text-3xl mb-2">‚öôÔ∏è</div>
                            <h4 class="font-semibold">2. Gatilho WordPress</h4>
                            <p class="text-xs text-slate-500">O plugin "Code Snippets" intercepta o envio.</p>
                        </div>
                        <div class="flow-arrow text-2xl hidden lg:block">‚Üí</div>
                        <div class="flow-step bg-white p-4 rounded-lg border-2">
                             <div class="text-3xl mb-2">üîÑ</div>
                            <h4 class="font-semibold">3. L√≥gica da Roleta</h4>
                            <p class="text-xs text-slate-500">Script busca corretores na API (com cache) e escolhe o pr√≥ximo da fila.</p>
                        </div>
                        <div class="flow-arrow text-2xl hidden md:block">‚Üí</div>
                         <div class="flow-step bg-white p-4 rounded-lg border-2">
                             <div class="text-3xl mb-2">üì¶</div>
                            <h4 class="font-semibold">4. Montagem dos Dados</h4>
                            <p class="text-xs text-slate-500">O script formata os dados para a API do RD.</p>
                        </div>
                        <div class="flow-arrow text-2xl hidden lg:block">‚Üí</div>
                        <div class="flow-step bg-white p-4 rounded-lg border-2">
                            <div class="text-3xl mb-2">üéØ</div>
                            <h4 class="font-semibold">5. Cria√ß√£o no CRM</h4>
                            <p class="text-xs text-slate-500">Negocia√ß√£o criada e atribu√≠da ao corretor da vez no RD Station.</p>
                        </div>
                    </div>
                </div>

                <div class="mt-8 grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold text-slate-800 mb-3">Objetivo</h3>
                        <p class="text-slate-600">Automatizar a entrada de leads no processo comercial, garantindo que cada envio de formul√°rio no site `frizonconstrutora.com.br` gerasse uma nova Negocia√ß√£o (Deal) no RD Station CRM. Adicionalmente, o sistema deveria distribuir os leads de forma sequencial e autom√°tica entre os membros de um time de corretores espec√≠fico, assegurando uma distribui√ß√£o justa e imediata.</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-slate-800 mb-3">Resultado</h3>
                        <p class="text-slate-600">A integra√ß√£o est√° conclu√≠da e totalmente funcional. O sistema n√£o s√≥ captura os leads de diferentes formul√°rios de forma robusta, como tamb√©m gerencia uma distribui√ß√£o automatizada e justa entre a equipe comercial, otimizando o processo de vendas desde o primeiro contato.</p>
                    </div>
                </div>

            </section>

            <!-- Section: Arquitetura -->
            <section id="architecture" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Arquitetura e Componentes</h2>
                <p class="text-lg text-slate-600 mb-8">A solu√ß√£o interliga diferentes plataformas e APIs. Abaixo est√£o os componentes centrais e as credenciais utilizadas.</p>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-xl font-semibold text-slate-800 mb-4">Plataformas e Ferramentas</h3>
                        <ul class="space-y-3">
                            <li class="flex items-start"><span class="bg-teal-100 text-teal-800 text-xs font-semibold mr-3 px-2.5 py-0.5 rounded-full">Plataforma</span> <div><strong>WordPress</strong><p class="text-sm text-slate-500">Sistema de gerenciamento de conte√∫do do site.</p></div></li>
                            <li class="flex items-start"><span class="bg-teal-100 text-teal-800 text-xs font-semibold mr-3 px-2.5 py-0.5 rounded-full">Plugin</span> <div><strong>Contact Form 7</strong><p class="text-sm text-slate-500">Respons√°vel pela cria√ß√£o dos formul√°rios de captura.</p></div></li>
                            <li class="flex items-start"><span class="bg-teal-100 text-teal-800 text-xs font-semibold mr-3 px-2.5 py-0.5 rounded-full">Plugin</span> <div><strong>Code Snippets</strong><p class="text-sm text-slate-500">Onde o c√≥digo de integra√ß√£o foi implementado de forma segura.</p></div></li>
                            <li class="flex items-start"><span class="bg-teal-100 text-teal-800 text-xs font-semibold mr-3 px-2.5 py-0.5 rounded-full">CRM</span> <div><strong>RD Station CRM</strong><p class="text-sm text-slate-500">Destino final dos leads e centro da gest√£o comercial.</p></div></li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-xl font-semibold text-slate-800 mb-4">Credenciais e Endpoints</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-slate-600">Token da API do RD Station</label>
                                <div class="flex items-center mt-1">
                                    <input type="text" id="api-token" value="00000000000000000" readonly class="w-full bg-slate-100 border-slate-300 rounded-l-md text-sm p-2 font-mono">
                                    <button onclick="copyToClipboard('api-token')" class="bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-2 rounded-r-md transition-colors">Copiar</button>
                                </div>
                            </div>
                             <div>
                                <label class="text-sm font-medium text-slate-600">ID do Time de Corretores</label>
                                <div class="flex items-center mt-1">
                                    <input type="text" id="team-id" value="6855f3e38094780018f822e2" readonly class="w-full bg-slate-100 border-slate-300 rounded-l-md text-sm p-2 font-mono">
                                    <button onclick="copyToClipboard('team-id')" class="bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-2 rounded-r-md transition-colors">Copiar</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-slate-600">Endpoints da API v1</label>
                                <ul class="text-sm mt-1 space-y-1 font-mono text-slate-700">
                                    <li><code class="bg-slate-100 p-1 rounded">/api/v1/deals</code></li>
                                    <li><code class="bg-slate-100 p-1 rounded">/api/v1/teams/{id}</code></li>
                                </ul>
                            </div>
                        </div>
                         <p id="copy-feedback" class="text-sm text-teal-600 mt-3 h-5"></p>
                    </div>
                </div>

                <div class="mt-8 bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Campos Personalizados no RD Station</h3>
                    <p class="text-slate-600 mb-4">Para armazenar informa√ß√µes espec√≠ficas vindas dos formul√°rios, os seguintes campos foram criados na entidade "Negocia√ß√µes" dentro do CRM.</p>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-slate-100 text-slate-600">
                                <tr>
                                    <th class="p-3">ID do Campo</th>
                                    <th class="p-3">Nome do Campo</th>
                                    <th class="p-3">Finalidade</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-slate-200">
                                    <td class="p-3 font-mono">68540a13b68281001d969881</td>
                                    <td class="p-3 font-medium">Mensagem Inicial</td>
                                    <td class="p-3">Armazena a mensagem enviada pelo cliente.</td>
                                </tr>
                                <tr class="border-b border-slate-200">
                                    <td class="p-3 font-mono">68540a7b4ae32c001e0e475c</td>
                                    <td class="p-3 font-medium">WhatsApp</td>
                                    <td class="p-3">Armazena o telefone do cliente.</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-mono">68540a95e244870014797800</td>
                                    <td class="p-3 font-medium">Origem</td>
                                    <td class="p-3">Armazena o nome do formul√°rio de origem do lead.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Section: Mapeamento de Formul√°rios -->
            <section id="mapping" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Mapeamento de Formul√°rios</h2>
                <p class="text-lg text-slate-600 mb-8">O script foi programado para lidar com as varia√ß√µes de campos entre os diferentes formul√°rios do site. Esta tabela detalha os IDs e os campos relevantes para cada um.</p>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-100 text-slate-600">
                            <tr>
                                <th class="p-3">ID</th>
                                <th class="p-3">T√≠tulo do Formul√°rio</th>
                                <th class="p-3">Tipo</th>
                                <th class="p-3">Tags de Campos Relevantes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-slate-200 hover:bg-slate-50">
                                <td class="p-3 font-semibold">15482</td>
                                <td class="p-3">Contact form 1</td>
                                <td class="p-3"><span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Principal</span></td>
                                <td class="p-3 font-mono">`first-name`, `tel`, `your-email`, `your-message`</td>
                            </tr>
                            <tr class="border-b border-slate-200 hover:bg-slate-50">
                                <td class="p-3 font-semibold">5</td>
                                <td class="p-3">Formul√°rio de contato 1</td>
                                <td class="p-3"><span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Principal</span></td>
                                <td class="p-3 font-mono">`your-name`, `your-email`, `your-message`</td>
                            </tr>
                            <tr class="border-b border-slate-200 hover:bg-slate-50">
                                <td class="p-3 font-semibold">16146</td>
                                <td class="p-3">Simula√ß√£o Bella Frizon</td>
                                <td class="p-3"><span class="bg-purple-100 text-purple-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Simula√ß√£o (Exce√ß√£o)</span></td>
                                <td class="p-3 font-mono">`nome`, `fone`, `email`</td>
                            </tr>
                            <tr class="border-b border-slate-200 hover:bg-slate-50">
                                <td class="p-3 font-semibold">16145</td>
                                <td class="p-3">Simula√ß√£o Dante</td>
                                <td class="p-3"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Simula√ß√£o (Padr√£o)</span></td>
                                <td class="p-3 font-mono">`cliente`, `telefone`, `email`</td>
                            </tr>
                            <tr class="border-b border-slate-200 hover:bg-slate-50">
                                <td class="p-3 font-semibold">16147</td>
                                <td class="p-3">Simula√ß√£o Malibu</td>
                                <td class="p-3"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Simula√ß√£o (Padr√£o)</span></td>
                                <td class="p-3 font-mono">`cliente`, `telefone`, `email`</td>
                            </tr>
                            <tr class="hover:bg-slate-50">
                                <td class="p-3 font-semibold">16144</td>
                                <td class="p-3">Simula√ß√£o Portal</td>
                                <td class="p-3"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">Simula√ß√£o (Padr√£o)</span></td>
                                <td class="p-3 font-mono">`cliente`, `telefone`, `email`</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Section: Code Explorer -->
            <section id="code" class="content-section">
                 <h2 class="text-3xl font-bold text-slate-900 mb-2">Explorador de C√≥digo</h2>
                <p class="text-lg text-slate-600 mb-8">Navegue pelo c√≥digo-fonte da integra√ß√£o. Clique nos marcadores <span class="code-marker">destacados</span> para ver uma explica√ß√£o detalhada de cada bloco l√≥gico.</p>

                <div class="flex flex-col md:flex-row gap-6">
                    <!-- Code Block -->
                    <div class="w-full md:w-2/3 bg-slate-800 text-white p-4 rounded-lg shadow-lg overflow-x-auto">
                        <pre><code class="language-php text-sm">
&lt;?php

// Fun√ß√£o Auxiliar
function get_frizon_corretores_ids() {
    <span class="code-marker" data-target="code-1">/* Tenta buscar dados do cache */</span>
    $transient_name = 'frizon_corretores_cache';
    $cached_user_ids = get_transient($transient_name);
    if (false !== $cached_user_ids) {
        return $cached_user_ids;
    }

    <span class="code-marker" data-target="code-2">/* Se n√£o houver cache, busca na API */</span>
    $team_id = '6855f3e38094780018f822e2';
    $token = '00000000000000000000000000000';
    $api_url = ".../teams/{$team_id}?token={$token}";

    $response = wp_remote_get($api_url, ...);
    if (is_wp_error($response) || ...) {
        return [];
    }

    $body = wp_remote_retrieve_body($response);
    $data = json_decode($body);
    $user_ids = !empty($data->user_ids) ? $data->user_ids : [];

    <span class="code-marker" data-target="code-3">/* Salva a nova lista no cache por 12h */</span>
    set_transient($transient_name, $user_ids, 12 * HOUR_IN_SECONDS);
    return $user_ids;
}

// Fun√ß√£o Principal
function enviar_negociacao_definitiva_frizon(...) {
    
    <span class="code-marker" data-target="code-4">/* L√≥gica de Distribui√ß√£o (Roleta) */</span>
    $corretores_ids = get_frizon_corretores_ids();
    if (!empty($corretores_ids)) {
        $ultimo_indice = get_option('indice_ultimo_corretor_frizon', -1);
        $proximo_indice = ($ultimo_indice + 1) % count($corretores_ids);
        $id_do_corretor_da_vez = $corretores_ids[$proximo_indice];
        update_option('indice_ultimo_corretor_frizon', $proximo_indice);
    }
    
    <span class="code-marker" data-target="code-5">/* Captura e Mapeamento de Campos */</span>
    $submission = WPCF7_Submission::get_instance();
    $posted_data = $submission->get_posted_data();
    // ... L√≥gica condicional para mapear os campos ...
    if ($id_atual == $id_simulacao_bella_frizon) {
        // ...
    } elseif (in_array($id_atual, $ids_simulacao_padrao)) {
        // ...
    } else {
        // ...
    }
    
    <span class="code-marker" data-target="code-6">/* Montagem do Payload para a API */</span>
    $deal_payload = [ 'deal' => [ ... ], 'contacts' => [ ... ] ];
    if (!empty($id_do_corretor_da_vez)) {
        $deal_payload['deal']['user_id'] = $id_do_corretor_da_vez;
    }

    <span class="code-marker" data-target="code-7">/* Envio para o RD Station */</span>
    $api_url = '.../deals?token=...';
    $args = [ 'method' => 'POST', ... ];
    wp_remote_post($api_url, $args);
}

<span class="code-marker" data-target="code-8">/* Gatilho de Execu√ß√£o */</span>
add_action('wpcf7_mail_sent', 'enviar_negociacao_definitiva_frizon');
                        </code></pre>
                    </div>

                    <!-- Explanation Panel -->
                    <div class="w-full md:w-1/3">
                        <div id="code-explanation" class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 sticky top-6">
                            <h3 id="explanation-title" class="text-lg font-semibold text-teal-800">Clique em um marcador</h3>
                            <p id="explanation-text" class="text-slate-600 mt-2">Passe o mouse e clique em uma das se√ß√µes destacadas no c√≥digo para entender o que ela faz.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Manuten√ß√£o -->
            <section id="maintenance" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Manuten√ß√£o e Diagn√≥stico</h2>
                <p class="text-lg text-slate-600 mb-8">Instru√ß√µes para futuras atualiza√ß√µes e para solucionar problemas comuns que possam surgir.</p>
                
                <div class="space-y-4">
                    <div class="accordion-item bg-white rounded-lg border border-slate-200 shadow-sm">
                        <h3 class="accordion-header cursor-pointer flex justify-between items-center p-4">
                            <span class="font-semibold text-slate-800">Como alterar o time de corretores?</span>
                            <svg class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h3>
                        <div class="accordion-content hidden p-4 border-t border-slate-200">
                            <p class="text-slate-600">Nenhuma a√ß√£o √© necess√°ria no c√≥digo. A solu√ß√£o √© din√¢mica. Basta **adicionar ou remover usu√°rios do time "Corretores" diretamente no painel do RD Station CRM**. O sistema ir√° buscar a lista atualizada automaticamente a cada 12 horas.</p>
                        </div>
                    </div>
                    <div class="accordion-item bg-white rounded-lg border border-slate-200 shadow-sm">
                        <h3 class="accordion-header cursor-pointer flex justify-between items-center p-4">
                            <span class="font-semibold text-slate-800">Como adicionar um novo formul√°rio?</span>
                            <svg class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h3>
                        <div class="accordion-content hidden p-4 border-t border-slate-200">
                           <ol class="list-decimal list-inside text-slate-600 space-y-2">
                                <li>Crie o formul√°rio no Contact Form 7.</li>
                                <li>Encontre seu ID num√©rico (vis√≠vel no shortcode, por exemplo).</li>
                                <li>Adicione o ID √† lista `$ids_dos_formularios_alvo` no script.</li>
                                <li>Verifique os nomes das tags de campo do novo formul√°rio (ex: `[text* your-name]`) e garanta que eles sejam contemplados pela l√≥gica condicional. Se forem diferentes dos padr√µes existentes, um novo bloco `else if` pode ser necess√°rio.</li>
                           </ol>
                        </div>
                    </div>
                    <div class="accordion-item bg-white rounded-lg border border-slate-200 shadow-sm">
                        <h3 class="accordion-header cursor-pointer flex justify-between items-center p-4">
                            <span class="font-semibold text-slate-800">O que fazer se a integra√ß√£o parar de funcionar?</span>
                            <svg class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h3>
                        <div class="accordion-content hidden p-4 border-t border-slate-200">
                           <ol class="list-decimal list-inside text-slate-600 space-y-2">
                                <li>**Verifique as Credenciais:** Confirme se o Token da API ou o ID do Time n√£o foram alterados ou revogados no RD Station CRM.</li>
                                <li>**Verifique o Time:** Assegure-se de que o time de "Corretores" no RD Station n√£o est√° vazio.</li>
                                <li>**Verifique os Formul√°rios:** Confirme se os IDs dos formul√°rios ou os nomes (tags) dos campos n√£o foram alterados no Contact Form 7.</li>
                                <li>**Force a Limpeza do Cache:** Para for√ßar uma nova busca da lista de corretores, o cache (transient) pode ser limpo. Isso pode ser feito com plugins como "Transients Manager" ou alterando temporariamente o nome do transient no c√≥digo (de `'frizon_corretores_cache'` para `'frizon_corretores_cache_v2'`).</li>
                           </ol>
                        </div>
                    </div>
                </div>

            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');
            const codeMarkers = document.querySelectorAll('.code-marker');
            const explanationTitle = document.getElementById('explanation-title');
            const explanationText = document.getElementById('explanation-text');
            const accordionHeaders = document.querySelectorAll('.accordion-header');

            const explanations = {
                'code-1': {
                    title: '1. Otimiza√ß√£o com Cache',
                    text: 'O script primeiro verifica se uma lista de corretores j√° existe no cache do WordPress (transient). Se existir e n√£o tiver expirado (12 horas), ele a utiliza imediatamente, evitando uma chamada desnecess√°ria √† API e tornando o processo muito mais r√°pido.'
                },
                'code-2': {
                    title: '2. Busca Din√¢mica na API',
                    text: 'Se o cache estiver vazio ou expirado, o script faz uma chamada GET para a API do RD Station, usando o ID do time, para obter a lista mais atualizada de IDs de usu√°rios (corretores).'
                },
                'code-3': {
                    title: '3. Armazenamento em Cache',
                    text: 'Ap√≥s obter a lista fresca da API, o script a salva no cache (transient) do WordPress com uma validade de 12 horas. Isso garante que a pr√≥xima execu√ß√£o seja r√°pida.'
                },
                'code-4': {
                    title: '4. L√≥gica de Distribui√ß√£o (Roleta)',
                    text: 'Este √© o cora√ß√£o da distribui√ß√£o. Ele pega o √≠ndice do √∫ltimo corretor que recebeu um lead (armazenado no banco de dados), soma 1, e usa o operador de m√≥dulo (%) para garantir que a contagem "zere" ao chegar no fim da lista. Depois, atualiza o √≠ndice no banco para a pr√≥xima vez.'
                },
                'code-5': {
                    title: '5. Mapeamento de Campos',
                    text: 'O script obt√©m os dados enviados pelo formul√°rio. Ele usa o ID do formul√°rio para entrar em uma estrutura condicional (if/else if/else) que mapeia corretamente os nomes dos campos (ex: "fone" vs "telefone") para vari√°veis padronizadas.'
                },
                'code-6': {
                    title: '6. Montagem do Payload',
                    text: 'Com todos os dados prontos, o script monta um array PHP (payload) na estrutura exata que a API do RD Station espera. √â aqui que o "user_id" do corretor da vez √© adicionado √† negocia√ß√£o.'
                },
                'code-7': {
                    title: '7. Envio para o RD Station',
                    text: 'O array PHP √© convertido para o formato JSON. Em seguida, a fun√ß√£o `wp_remote_post` do WordPress envia esses dados via POST para o endpoint de cria√ß√£o de negocia√ß√µes da API, efetivamente criando o lead no CRM.'
                },
                'code-8': {
                    title: '8. Gatilho de Execu√ß√£o',
                    text: 'Esta linha √© o que conecta tudo. Ela diz ao WordPress: "Quando o evento `wpcf7_mail_sent` (um formul√°rio do Contact Form 7 foi enviado com sucesso) acontecer, execute a nossa fun√ß√£o `enviar_negociacao_definitiva_frizon`."'
                }
            };

            // Navigation
            function setActiveSection(hash) {
                hash = hash || '#overview';

                navLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === hash);
                });

                sections.forEach(section => {
                    section.classList.toggle('active', '#' + section.id === hash);
                });
            }

            // Initial state from hash or default
            setActiveSection(window.location.hash);

            // Handle navigation clicks
            document.getElementById('main-nav').addEventListener('click', function(e) {
                if (e.target.closest('a')) {
                    const link = e.target.closest('a');
                    const hash = link.getAttribute('href');
                    setActiveSection(hash);
                }
            });
            
            // Handle popstate for back/forward buttons
            window.addEventListener('popstate', () => {
                 setActiveSection(window.location.hash);
            });

            // Code Explorer
            codeMarkers.forEach(marker => {
                marker.addEventListener('click', function() {
                    const targetId = this.dataset.target;
                    const explanation = explanations[targetId];

                    codeMarkers.forEach(m => m.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (explanation) {
                        explanationTitle.textContent = explanation.title;
                        explanationText.textContent = explanation.text;
                    }
                });
            });

            // Accordion
            accordionHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    const icon = this.querySelector('svg');
                    content.classList.toggle('hidden');
                    icon.classList.toggle('rotate-180');
                });
            });
        });

        // Copy to clipboard utility
        function copyToClipboard(elementId) {
            const input = document.getElementById(elementId);
            input.select();
            input.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                const feedback = document.getElementById('copy-feedback');
                feedback.textContent = 'Copiado para a √°rea de transfer√™ncia!';
                setTimeout(() => {
                    feedback.textContent = '';
                }, 2000);
            } catch (err) {
                console.error('Falha ao copiar: ', err);
            }

            window.getSelection().removeAllRanges();
        }

    </script>
</body>
</html>
